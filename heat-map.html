<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <script src='https://api.mapbox.com/mapbox.js/v2.2.4/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v2.2.4/mapbox.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script src="locations.js" charset="utf-8"></script>
    <script src="cn-all.js" charset="utf-8"></script>
    <script src="http://api.tiles.mapbox.com/mapbox.js/plugins/turf/v2.0.0/turf.min.js" charset="utf-8"></script>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />
    <script src="leaflet-heat.js" charset="utf-8"></script>
    <title>Cherry Sales Map</title>
    <style type="text/css" media="screen">
    #map{
      width: 100%;
      height: 100%;
    }
    </style>

</head>
<body>

  <div id="map">

  </div>


<script type="text/javascript">
  $(function () {
    L.mapbox.accessToken = 'pk.eyJ1IjoieXVud2VpIiwiYSI6IkhvMlVpZnMifQ.dQ98oRvdtNu2LzqmbnX0PQ';

    var map = L.mapbox.map('map', 'mapbox.streets');

    var provinces = L.geoJson(provinces_json,{style: style}).addTo(map);

    map.fitBounds(provinces);

    // get color depending on population density value
		function getColor(feature) {
      var d = 0
      var feature = turf.featurecollection([feature]);
      console.log('feature is', feature);
      var points = turf.featurecollection(addresses.map(function (address) {
        var p = turf.point([address[1],address[0]])
        return p;
      }));

      console.log('points are',points);

      var within = turf.within(points, feature);

      console.log(within);
      d = within.features.length;
			return d > 100 ? '#800026' :
			       d > 50  ? '#BD0026' :
			       d > 20  ? '#E31A1C' :
			       d > 10  ? '#FC4E2A' :
			       d > 5   ? '#FD8D3C' :
			       d > 3   ? '#FEB24C' :
			       d > 1   ? '#FED976' :
			                 '#FFEDA0';
		}

		function style(feature) {
			return {
				weight: 2,
				opacity: 1,
				color: 'white',
				dashArray: '3',
				fillOpacity: 0.7,
				fillColor: getColor(feature)
			};
		}

  });
</script>

</body>
</html>
